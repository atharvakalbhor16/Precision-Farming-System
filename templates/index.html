<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Farmer's Assistant - Home{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #a5c787;
        }
        .card {
            background-color: #f8f3e9;
            border-radius: 15px;
            transition: transform 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .header {
            background-color: #e9f1e5;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .footer {
            background-color: #e9f1e5;
        }
        .action-btn {
            background-color: #222222;
            color: white;
            border-radius: 25px;
            transition: all 0.3s ease;
        }
        .action-btn:hover {
            opacity: 0.9;
            transform: scale(1.02);
        }
        .weather-card {
            background-color: #f8f3e9;
            border-radius: 15px;
            min-height: 200px;
            transition: transform 0.3s ease;
        }
        .weather-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .dropdown {
            position: relative;
            display: inline-block;
        }
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f8f3e9;
            min-width: 200px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 10;
            border-radius: 8px;
            right: 0;
            overflow: hidden;
        }
        .dropdown-content a {
            color: #333;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            transition: background-color 0.3s;
        }
        .dropdown-content a:hover {
            background-color: #e9f1e5;
        }
        .dropdown:hover .dropdown-content {
            display: block;
            animation: fadeIn 0.3s;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .weather-icon {
            font-size: 2.5rem;
            margin-right: 1rem;
        }
        .animated-bg {
            background: linear-gradient(45deg, #a5c787, #ebe5e6, #a5c787);
            background-size: 200% 200%;
            animation: gradientBG 15s ease infinite;
        }
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .nav-item {
            position: relative;
        }
        .nav-item::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: 0;
            left: 50%;
            background-color: #333;
            transition: all 0.3s ease;
        }
        .nav-item:hover::after {
            width: 100%;
            left: 0;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header py-4 sticky top-0 z-50">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-gray-800 flex items-center">
                <i class="bi bi-flower1 text-green-600 mr-2"></i>
                <a href="{{ url_for('home') }}">Farmer's Assistant</a>
            </h1>
            <nav class="hidden md:flex space-x-6">
                <a href="{{ url_for('home') }}" class="text-gray-800 hover:text-gray-600 nav-item py-2">Home</a>
                <a href="#" class="text-gray-800 hover:text-gray-600 nav-item py-2">About us</a>
                <div class="dropdown nav-item py-2">
                    <a href="#" class="text-gray-800 hover:text-gray-600 flex items-center">
                        Services
                        <i class="bi bi-chevron-down ml-1 text-sm"></i>
                    </a>
                    <div class="dropdown-content">
                        <a href="{{ url_for('crop_recommendation') }}" class="flex items-center">
                            <i class="bi bi-tree text-green-600 mr-2"></i>
                            Crop Recommendation
                        </a>
                        <a href="{{ url_for('find_crop_disease') }}" class="flex items-center">
                            <i class="bi bi-bug text-red-500 mr-2"></i>
                            Disease Detection
                        </a>
                    </div>
                </div>
            </nav>
            <div class="dropdown">
                {% if 'user_id' in session %}
                <div class="w-10 h-10 rounded-full bg-white flex items-center justify-center border border-gray-300 cursor-pointer hover:bg-gray-100 transition-all">
                    <i class="bi bi-person text-2xl"></i>
                </div>
                <div class="dropdown-content">
                    <div class="px-4 py-3 text-sm text-gray-700 border-b border-gray-200">
                        <div class="font-medium">{{ session.get('user_name', 'Farmer') }}</div>
                        <div class="truncate">farmer@example.com</div>
                    </div>
                    <a href="#" class="flex items-center">
                        <i class="bi bi-gear mr-2"></i>
                        Settings
                    </a>
                    <a href="{{ url_for('logout') }}" class="flex items-center text-red-500">
                        <i class="bi bi-box-arrow-right mr-2"></i>
                        Logout
                    </a>
                </div>
                {% else %}
                <div class="flex items-center space-x-4">
                    <a href="{{ url_for('login') }}" class="text-gray-800 hover:text-gray-600">Login</a>
                    <a href="{{ url_for('register') }}" class="action-btn px-4 py-2">Register</a>
                </div>
                {% endif %}
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 my-4">
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
            <div class="alert bg-{% if category == 'success' %}green-100 text-green-700{% elif category == 'danger' %}red-100 text-red-700{% elif category == 'warning' %}yellow-100 text-yellow-700{% else %}blue-100 text-blue-700{% endif %} p-4 rounded-lg mb-4 flex justify-between items-center">
                {{ message }}
                <button type="button" class="text-gray-500 hover:text-gray-700" onclick="this.parentElement.style.display='none'">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            {% endfor %}
        {% endif %}
        {% endwith %}

        {% block content %}
        <!-- Hero Section -->
        <section class="py-10 animated-bg rounded-lg">
            <div class="container mx-auto px-4">
                <div class="flex flex-col md:flex-row items-center md:items-start md:justify-center text-left space-y-6 md:space-y-0 md:space-x-10">
                    <!-- Lottie Animation on the Left -->
                    <div class="flex-shrink-0">
                        <dotlottie-player 
                            src="https://lottie.host/9080dae1-cbe8-485b-af64-4e4bb2cdb168/sWIXkwEmQn.lottie" 
                            background="transparent" 
                            speed="1" 
                            style="width: 150px; height: 150px;" 
                            loop autoplay>
                        </dotlottie-player>
                    </div>
        
                    <!-- Text Content on the Right -->
                    <div class="text-center max-w-xl flex flex-col justify-center">
                        <h2 class="text-4xl font-bold text-gray-800 mb-4">
                            Welcome, {{ session.get('user_name', 'Farmer') }}!
                        </h2>
                        <p class="text-xl text-gray-700">
                            Your smart farming assistant. Get personalized recommendations and detect plant diseases instantly.
                        </p>
                    </div>
                    
                    
                </div>
            </div>
        </section>

        <!-- Main Content -->
        <main class="container mx-auto px-4 py-12">
            <div class="grid md:grid-cols-2 gap-8">
                <!-- Crop Recommendation Card -->
                <div class="card p-8">
                    <div class="flex flex-col items-center">
                        <div class="bg-green-100 rounded-full p-4 w-20 h-20 flex items-center justify-center mb-4">
                            <i class="bi bi-tree text-green-600 text-3xl"></i>
                        </div>
                        <h3 class="text-2xl font-semibold mb-4">Crop Recommendation</h3>
                        <p class="text-center mb-6 text-gray-600">Get personalized crop recommendations based on your soil conditions, local climate, and historical data to maximize your yield.</p>
                        <a href="{{ url_for('crop_recommendation') }}" class="action-btn px-8 py-3 font-medium flex items-center">
                            Get Recommendations
                            <i class="bi bi-arrow-right ml-2"></i>
                        </a>
                    </div>
                </div>

                <!-- Disease Detection Card -->
                <div class="card p-8">
                    <div class="flex flex-col items-center">
                        <div class="bg-red-100 rounded-full p-4 w-20 h-20 flex items-center justify-center mb-4">
                            <i class="bi bi-bug text-red-500 text-3xl"></i>
                        </div>
                        <h3 class="text-2xl font-semibold mb-4">Disease Detection</h3>
                        <p class="text-center mb-6 text-gray-600">Upload photos of your plants to quickly identify diseases, pests, and deficiencies, then get expert treatment advice to protect your crops.</p>
                        <a href="{{ url_for('find_crop_disease') }}" class="action-btn px-8 py-3 font-medium flex items-center">
                            Detect Diseases
                            <i class="bi bi-arrow-right ml-2"></i>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Weather Card -->
            <div class="weather-card mt-10 p-6">
                <div class="flex items-center gap-3 mb-3">
                    <div class="weather-icon text-yellow-500">
                        <i class="bi bi-sun"></i>
                    </div>
                    <div>
                        <h3 class="text-2xl font-semibold">Local Weather Forecast</h3>
                        <p class="text-gray-600">Daily updates to plan your farming activities</p>
                    </div>
                </div>
                <div id="weather-data" class="mt-5 p-4 bg-white bg-opacity-50 rounded-lg">
                    <!-- Weather data will be loaded here -->
                </div>
            </div>

            <!-- Quick Tips Section -->
            <div class="mt-12">
                <h3 class="text-2xl font-semibold mb-6 text-center">Seasonal Farming Tips</h3>
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="bg-blue-50 p-6 rounded-lg">
                        <i class="bi bi-droplet text-blue-500 text-3xl mb-3"></i>
                        <h4 class="font-semibold mb-2">Water Management</h4>
                        <p class="text-gray-700">Adjust irrigation schedules based on humidity levels and weather forecasts to save water and prevent plant diseases.</p>
                    </div>
                    <div class="bg-yellow-50 p-6 rounded-lg">
                        <i class="bi bi-sun text-yellow-500 text-3xl mb-3"></i>
                        <h4 class="font-semibold mb-2">Sunlight Optimization</h4>
                        <p class="text-gray-700">Position sun-loving crops to maximize daylight exposure, especially during shorter daylight hours.</p>
                    </div>
                    <div class="bg-green-50 p-6 rounded-lg">
                        <i class="bi bi-trash text-green-500 text-3xl mb-3"></i>
                        <h4 class="font-semibold mb-2">Sustainable Practices</h4>
                        <p class="text-gray-700">Consider crop rotation and companion planting to naturally manage pests and improve soil quality.</p>
                    </div>
                </div>
            </div>
        </main>
        {% endblock %}
    </div>

    <!-- Footer -->
    <footer class="footer py-8 text-center mt-10">
        <div class="container mx-auto ">
           
            <div class="grid md:grid-cols-3 gap-4 mb-6 text-left">
                <div>
                    <h3 class="font-semibold mb-3">Farmer's Assistant</h3>
                    <p class="text-black">Helping farmers make data-driven decisions to optimize crop yields and farming operations.</p>
                </div>
                <div>
                    <h3 class="font-semibold mb-3">Quick Links</h3>
                    <ul class="space-y-1">
                        <li><a href="#" class="text-black  hover:text-[#a5c787] transition">About Us</a></li>
                        <li><a href="#" class="text-black  hover:text-[#a5c787] transition">Home</a></li>
                        <li><a href="#" class="text-black  hover:text-[#a5c787] transition">Services</a></li>
                        <li><a href="#" class="text-black  hover:text-[#a5c787] transition">Contact</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-semibold mb-3">Connect With Us</h3>
                    <div class="flex gap-3">
                        <a href="#" class="text-black hover:text-[#a5c787] transition"><i class="bi bi-facebook"></i></a>
                        <a href="#" class="text-black hover:text-[#a5c787] transition"><i class="bi bi-twitter-x"></i></a>
                        <a href="#" class="text-black hover:text-[#a5c787] transition"><i class="bi bi-instagram"></i></a>
                        <a href="#" class="text-black hover:text-[#a5c787] transition"><i class="bi bi-linkedin"></i></a>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-800 pt-4">
                © 2025 Farmer's Assistant. All rights reserved.
                <div class="flex justify-center items-center gap-1 mt-1">
                    Made with <i class="bi bi-heart-fill text-red-500"></i> by Farmer's Assistant
                </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs" type="module"></script>

    <script>
        
        // Weather forecast initialization
        document.addEventListener('DOMContentLoaded', function() {
            const weatherData = document.getElementById('weather-data');
            
            // First show a loading state
            weatherData.innerHTML = `
                <div class="flex justify-center items-center p-4">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"></div>
                    <p class="ml-2">Getting weather data for your location...</p>
                </div>
            `;
            
            // Get user's location
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    // Success callback
                    position => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        fetchWeatherData(lat, lon);
                    },
                    // Error callback
                    error => {
                        console.error("Geolocation error:", error);
                        weatherData.innerHTML = `
                            <div class="p-4 text-center">
                                <i class="bi bi-exclamation-triangle text-yellow-500 text-3xl mb-2"></i>
                                <p>Unable to access your location. ${error.message}</p>
                                <button onclick="requestLocationPermission()" class="mt-3 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition">
                                    Allow Location Access
                                </button>
                            </div>
                        `;
                    },
                    // Options
                    { timeout: 10000 }
                );
            } else {
                weatherData.innerHTML = `
                    <div class="p-4 text-center">
                        <i class="bi bi-exclamation-triangle text-yellow-500 text-3xl mb-2"></i>
                        <p>Geolocation is not supported by your browser.</p>
                    </div>
                `;
            }
        });
        
        // Function to request location permission again
        function requestLocationPermission() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        fetchWeatherData(lat, lon);
                    },
                    error => {
                        const weatherData = document.getElementById('weather-data');
                        weatherData.innerHTML = `
                            <div class="p-4 text-center">
                                <i class="bi bi-exclamation-triangle text-yellow-500 text-3xl mb-2"></i>
                                <p>Permission denied. Please enable location services in your browser settings.</p>
                            </div>
                        `;
                    }
                );
            }
        }
        
        // Function to fetch weather data using OpenWeatherMap API
        function fetchWeatherData(lat, lon) {
            const weatherData = document.getElementById('weather-data');
            
            // Replace 'YOUR_API_KEY' with your actual OpenWeatherMap API key
            const apiKey = '1fb068de47d9394f1bf455edd5419801';
            const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=${apiKey}`;
            
            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    // Get weather icon
                    const iconCode = data.weather[0].icon;
                    const iconUrl = `https://openweathermap.org/img/wn/${iconCode}@2x.png`;
                    
                    // Map weather condition to Bootstrap icon class
                    const weatherIconMap = {
                        '01d': 'bi-sun', // clear sky day
                        '01n': 'bi-moon', // clear sky night
                        '02d': 'bi-cloud-sun', // few clouds day
                        '02n': 'bi-cloud-moon', // few clouds night
                        '03d': 'bi-cloud', // scattered clouds
                        '03n': 'bi-cloud', // scattered clouds
                        '04d': 'bi-clouds', // broken clouds
                        '04n': 'bi-clouds', // broken clouds
                        '09d': 'bi-cloud-drizzle', // shower rain
                        '09n': 'bi-cloud-drizzle', // shower rain
                        '10d': 'bi-cloud-rain', // rain day
                        '10n': 'bi-cloud-rain', // rain night
                        '11d': 'bi-cloud-lightning', // thunderstorm
                        '11n': 'bi-cloud-lightning', // thunderstorm
                        '13d': 'bi-snow', // snow
                        '13n': 'bi-snow', // snow
                        '50d': 'bi-cloud-fog', // mist
                        '50n': 'bi-cloud-fog' // mist
                    };
                    
                    const iconClass = weatherIconMap[iconCode] || 'bi-cloud';
                    
                    // Get location name
                    const cityName = data.name;
                    const country = data.sys.country;
                    
                    // Format temperature and other data
                    const temp = Math.round(data.main.temp);
                    const description = data.weather[0].description;
                    const windSpeed = Math.round(data.wind.speed * 3.6); // convert m/s to km/h
                    const humidity = data.main.humidity;
                    
                    // Calculate precipitation (if available)
                    let precipitation = '0%';
                    if (data.rain && data.rain['1h']) {
                        precipitation = `${data.rain['1h']} mm`;
                    }
                    
                    // Add farming tip based on weather condition
                    let farmingTip = '';
                    if (iconCode.startsWith('01') || iconCode.startsWith('02')) {
                        farmingTip = 'Great day for harvesting or field work!';
                    } else if (iconCode.startsWith('09') || iconCode.startsWith('10')) {
                        farmingTip = 'Consider postponing spraying operations due to rain.';
                    } else if (iconCode.startsWith('11')) {
                        farmingTip = 'Bring livestock to shelter and secure equipment.';
                    } else if (iconCode.startsWith('13')) {
                        farmingTip = 'Check on cold-sensitive crops and livestock.';
                    } else if (iconCode.startsWith('50')) {
                        farmingTip = 'Reduced visibility may affect machinery operation.';
                    } else {
                        farmingTip = 'Moderate conditions for most farming activities.';
                    }
                    
                    // Update the weather display
                    weatherData.innerHTML = `
                        <div class="flex flex-col md:flex-row items-start md:items-center">
                            <div class="flex items-center mr-6 mb-3 md:mb-0">
                                <i class="bi ${iconClass} text-5xl mr-4"></i>
                                <div>
                                    <p class="text-md font-medium">${cityName}, ${country}</p>
                                    <p class="text-3xl font-bold">${temp}°C</p>
                                    <p class="capitalize">${description}</p>
                                </div>
                            </div>
                            <div class="grid grid-cols-3 gap-4">
                                <div>
                                    <p class="text-gray-500 text-sm">Wind</p>
                                    <p class="font-semibold">${windSpeed} km/h</p>
                                </div>
                                <div>
                                    <p class="text-gray-500 text-sm">Humidity</p>
                                    <p class="font-semibold">${humidity}%</p>
                                </div>
                                <div>
                                    <p class="text-gray-500 text-sm">Precipitation</p>
                                    <p class="font-semibold">${precipitation}</p>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-green-50 rounded-lg">
                            <p class="text-gray-700"><i class="bi bi-lightbulb text-yellow-500 mr-2"></i> <strong>Farming Tip:</strong> ${farmingTip}</p>
                        </div>
                        <div class="mt-3 pt-3 border-t border-gray-200">
                            <p class="text-sm text-gray-600">
                                <i class="bi bi-geo-alt mr-1"></i> Weather data for your current location
                                <button onclick="refreshWeather()" class="ml-2 text-green-600 hover:text-green-800 transition">
                                    <i class="bi bi-arrow-clockwise"></i> Refresh
                                </button>
                            </p>
                        </div>
                    `;
                })
                .catch(error => {
                    console.error('Error fetching weather data:', error);
                    weatherData.innerHTML = `
                        <div class="p-4 text-center">
                            <i class="bi bi-exclamation-triangle text-yellow-500 text-3xl mb-2"></i>
                            <p>Unable to fetch weather data. Please try again later.</p>
                            <button onclick="retryFetchWeather(${lat}, ${lon})" class="mt-3 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition">
                                Try Again
                            </button>
                        </div>
                    `;
                });
        }
        
        // Function to retry fetching weather data
        function retryFetchWeather(lat, lon) {
            fetchWeatherData(lat, lon);
        }
        
        // Function to refresh weather data
        function refreshWeather() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        fetchWeatherData(lat, lon);
                    },
                    error => {
                        console.error("Geolocation error on refresh:", error);
                        const weatherData = document.getElementById('weather-data');
                        weatherData.innerHTML = `
                            <div class="p-4 text-center">
                                <i class="bi bi-exclamation-triangle text-yellow-500 text-3xl mb-2"></i>
                                <p>Unable to refresh location. ${error.message}</p>
                                <button onclick="requestLocationPermission()" class="mt-3 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition">
                                    Allow Location Access
                                </button>
                            </div>
                        `;
                    }
                );
            }
        }
    </script>
</body>
</html>